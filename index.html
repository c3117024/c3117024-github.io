<!DOCTYPE html>
<html lang="zh-TW" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>福岡八天七夜自駕遊行程</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Tailwind Dark Mode Configuration
        tailwind.config = {
            darkMode: 'class',
        }
        // Check local storage or system preference on load
        if (localStorage.getItem('color-theme') === 'dark' || (!('color-theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark');
        }
    </script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        body { font-family: 'Noto Sans TC', sans-serif; }
        .reservation-pulse { animation: pulse-red 2s infinite; }
        @keyframes pulse-red {
            0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            70% { box-shadow: 0 0 0 6px rgba(239, 68, 68, 0); }
            100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }
        /* Link styling */
        a.map-link:hover {
            text-decoration: underline;
            opacity: 0.8;
        }
        /* Chat Widget Animations */
        .chat-slide-in {
            animation: slideIn 0.3s ease-out forwards;
        }
        .chat-slide-out {
            animation: slideOut 0.3s ease-in forwards;
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px) scale(0.95); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }
        @keyframes slideOut {
            from { opacity: 1; transform: translateY(0) scale(1); }
            to { opacity: 0; transform: translateY(20px) scale(0.95); }
        }
        .typing-dot {
            animation: typing 1.4s infinite ease-in-out both;
        }
        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        @keyframes typing {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }
        /* Weather Fade In */
        .weather-loaded {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        /* Hide scrollbar for nav */
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        /* Print styles */
        @media print {
            #ai-assistant-btn, #ai-chat-modal, .nav-sticky, #theme-toggle {
                display: none !important;
            }
            .container {
                width: 100% !important;
                max-width: none !important;
            }
            body {
                background: white;
                color: black;
            }
            .dark body {
                background: white;
                color: black;
            }
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-700 dark:bg-slate-900 dark:text-slate-200 relative transition-colors duration-300">

    <!-- Hero Header -->
    <div class="bg-gradient-to-r from-blue-600 to-teal-500 text-white shadow-lg relative overflow-hidden">
        <div class="absolute inset-0 bg-[url('https://images.unsplash.com/photo-1624253321171-1be53e12f5f4?q=80&w=1200&auto=format&fit=crop')] bg-cover bg-center opacity-20"></div>
        <div class="container mx-auto px-4 py-6 flex justify-between items-center relative z-10">
            <div>
                <h1 class="text-2xl md:text-3xl font-bold"><i class="fas fa-plane-arrival mr-2"></i>福岡自駕之旅</h1>
                <p class="text-sm opacity-90 mt-1 font-medium"><i class="far fa-calendar-alt mr-1"></i> 2025/12/07 - 2025/12/14</p>
            </div>
            <div class="flex items-center gap-3">
                <div class="hidden md:block text-xs font-medium bg-white/20 px-3 py-1 rounded-full backdrop-blur-sm border border-white/30">
                    <span class="inline-block w-2 h-2 rounded-full bg-red-400 mr-1 animate-pulse"></span>
                    紅色為訂位/指定時間
                </div>
                <!-- Dark Mode Toggle -->
                <button id="theme-toggle" class="w-10 h-10 rounded-full bg-white/20 backdrop-blur-sm border border-white/30 flex items-center justify-center text-white hover:bg-white/30 transition-colors focus:outline-none">
                    <i class="fas fa-moon" id="theme-toggle-dark-icon"></i>
                    <i class="fas fa-sun hidden" id="theme-toggle-light-icon"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Sticky Navigation -->
    <div class="sticky top-0 z-40 bg-white/90 dark:bg-slate-900/90 backdrop-blur shadow-sm border-b border-slate-200 dark:border-slate-700 nav-sticky transition-colors duration-300">
        <div class="container mx-auto px-4">
            <div class="flex space-x-2 overflow-x-auto py-3 scrollbar-hide">
                <a href="#day-1" class="whitespace-nowrap px-4 py-1.5 rounded-full text-sm font-medium bg-slate-100 text-slate-600 hover:bg-blue-100 hover:text-blue-600 dark:bg-slate-800 dark:text-slate-300 dark:hover:bg-blue-900/50 dark:hover:text-blue-300 transition-colors">Day 1 福岡</a>
                <a href="#day-2" class="whitespace-nowrap px-4 py-1.5 rounded-full text-sm font-medium bg-slate-100 text-slate-600 hover:bg-teal-100 hover:text-teal-600 dark:bg-slate-800 dark:text-slate-300 dark:hover:bg-teal-900/50 dark:hover:text-teal-300 transition-colors">Day 2 熊本移動</a>
                <a href="#day-3" class="whitespace-nowrap px-4 py-1.5 rounded-full text-sm font-medium bg-slate-100 text-slate-600 hover:bg-indigo-100 hover:text-indigo-600 dark:bg-slate-800 dark:text-slate-300 dark:hover:bg-indigo-900/50 dark:hover:text-indigo-300 transition-colors">Day 3 熊本市區</a>
                <a href="#day-4" class="whitespace-nowrap px-4 py-1.5 rounded-full text-sm font-medium bg-slate-100 text-slate-600 hover:bg-green-100 hover:text-green-600 dark:bg-slate-800 dark:text-slate-300 dark:hover:bg-green-900/50 dark:hover:text-green-300 transition-colors">Day 4 阿蘇</a>
                <a href="#day-5" class="whitespace-nowrap px-4 py-1.5 rounded-full text-sm font-medium bg-slate-100 text-slate-600 hover:bg-cyan-100 hover:text-cyan-600 dark:bg-slate-800 dark:text-slate-300 dark:hover:bg-cyan-900/50 dark:hover:text-cyan-300 transition-colors">Day 5 高千穗</a>
                <a href="#day-6" class="whitespace-nowrap px-4 py-1.5 rounded-full text-sm font-medium bg-slate-100 text-slate-600 hover:bg-pink-100 hover:text-pink-600 dark:bg-slate-800 dark:text-slate-300 dark:hover:bg-pink-900/50 dark:hover:text-pink-300 transition-colors">Day 6 由布院</a>
                <a href="#day-7" class="whitespace-nowrap px-4 py-1.5 rounded-full text-sm font-medium bg-slate-100 text-slate-600 hover:bg-purple-100 hover:text-purple-600 dark:bg-slate-800 dark:text-slate-300 dark:hover:bg-purple-900/50 dark:hover:text-purple-300 transition-colors">Day 7 博多</a>
                <a href="#day-8" class="whitespace-nowrap px-4 py-1.5 rounded-full text-sm font-medium bg-slate-100 text-slate-600 hover:bg-slate-200 hover:text-slate-800 dark:bg-slate-800 dark:text-slate-300 dark:hover:bg-slate-700 dark:hover:text-slate-200 transition-colors">Day 8 回程</a>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container mx-auto px-4 py-8 pb-24"> <!-- Added pb-24 for space for chat button -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6" id="itinerary-content">

            <!-- Day 1 -->
            <div id="day-1" class="scroll-mt-24 bg-white dark:bg-slate-800 rounded-xl shadow-md overflow-hidden hover:shadow-xl hover:-translate-y-1 transition-all duration-300 border-t-4 border-blue-500 dark:border-blue-600 flex flex-col">
                <div class="p-5 flex-1">
                    <div class="flex justify-between items-start mb-4 border-b border-slate-100 dark:border-slate-700 pb-3">
                        <div>
                            <span class="text-xs font-bold text-blue-600 dark:text-blue-400 uppercase tracking-wider">Day 1</span>
                            <h2 class="text-lg font-bold text-slate-800 dark:text-white">福岡抵達</h2>
                        </div>
                        <div class="text-center bg-slate-100 dark:bg-slate-700 rounded p-1 min-w-[60px]">
                            <div class="text-xs text-slate-500 dark:text-slate-400">12/07</div>
                            <div class="text-sm font-bold text-blue-600 dark:text-blue-400 mb-1">週日</div>
                            <!-- Weather Widget -->
                            <div id="weather-day-1" class="text-xs text-slate-400 dark:text-slate-500 min-h-[1.5em] flex flex-col items-center justify-center">
                                <i class="fas fa-circle-notch fa-spin"></i>
                            </div>
                        </div>
                    </div>
                    
                    <ul class="space-y-4">
                        <li class="flex items-start bg-blue-50 dark:bg-blue-900/20 p-2 rounded-lg border border-blue-100 dark:border-blue-800/50">
                            <i class="fas fa-plane-arrival mt-1 mr-3 text-blue-600 dark:text-blue-400"></i>
                            <div>
                                <span class="block font-bold text-blue-800 dark:text-blue-200">BR106 抵達福岡</span>
                                <span class="text-xs text-blue-600 dark:text-blue-300">08:00 - 11:15</span>
                            </div>
                        </li>
                        <li class="flex items-start bg-blue-50 dark:bg-blue-900/20 p-2 rounded-lg border border-blue-100 dark:border-blue-800/50">
                            <i class="fas fa-plane-arrival mt-1 mr-3 text-blue-600 dark:text-blue-400"></i>
                            <div>
                                <span class="block font-bold text-blue-800 dark:text-blue-200">AK1510 抵達 (吳沛揚)</span>
                                <span class="text-xs text-blue-600 dark:text-blue-300">12:40 - 16:00</span>
                            </div>
                        </li>
                        <li class="flex items-start">
                            <i class="fas fa-utensils mt-1 mr-3 text-orange-400"></i>
                            <div>
                                <a href="https://maps.app.goo.gl/dumRLMzoyL9WcZYD6" target="_blank" class="block font-medium map-link text-blue-700 dark:text-blue-300">博多拉麵 ShinShin</a>
                                <span class="text-xs text-slate-500 dark:text-slate-400">必吃名店</span>
                            </div>
                        </li>
                        <li class="flex items-start">
                            <i class="fas fa-bread-slice mt-1 mr-3 text-yellow-500"></i>
                            <a href="https://maps.app.goo.gl/5wsPh9CqJ2bTsve77" target="_blank" class="font-medium map-link text-blue-700 dark:text-blue-300">明太子法棍</a>
                        </li>
                        <li class="flex items-start">
                            <i class="fas fa-shopping-bag mt-1 mr-3 text-purple-400"></i>
                            <div>
                                <a href="https://maps.app.goo.gl/vJtFXfRTthp9GsC37" target="_blank" class="font-medium map-link text-blue-700 dark:text-blue-300">Jiichiro JR Hakata City</a>
                                <span class="text-xs text-slate-400 dark:text-slate-500 block mt-1">年輪蛋糕</span>
                            </div>
                        </li>
                        <li class="flex items-start bg-red-50 dark:bg-red-900/20 p-2 rounded-lg border border-red-100 dark:border-red-800/50">
                            <i class="fas fa-clock mt-1 mr-3 text-red-500 dark:text-red-400"></i>
                            <div>
                                <a href="https://maps.app.goo.gl/tgueBokrnQpaHM959" target="_blank" class="block font-bold text-red-600 dark:text-red-300 map-link">藥院燒肉</a>
                                <span class="inline-block bg-red-500 text-white text-xs px-2 py-0.5 rounded mt-1 dark:bg-red-600">20:30 訂位</span>
                            </div>
                        </li>
                    </ul>
                </div>
                <!-- Hotel -->
                <div class="bg-slate-50 dark:bg-slate-700/50 p-4 border-t border-slate-100 dark:border-slate-700">
                    <div class="flex items-center bg-slate-800 dark:bg-slate-900 p-2 rounded-lg text-white shadow-sm">
                        <i class="fas fa-bed text-indigo-300 mr-3"></i>
                        <a href="https://maps.app.goo.gl/8yu2Mv63VQ5s9EyR6" target="_blank" class="font-medium text-sm hover:text-indigo-200 transition-colors">APA Hotel Hakata-higashihie-Ekimae</a>
                    </div>
                </div>
            </div>

            <!-- Day 2 -->
            <div id="day-2" class="scroll-mt-24 bg-white dark:bg-slate-800 rounded-xl shadow-md overflow-hidden hover:shadow-xl hover:-translate-y-1 transition-all duration-300 border-t-4 border-teal-500 dark:border-teal-600 flex flex-col">
                <div class="p-5 flex-1">
                    <div class="flex justify-between items-start mb-4 border-b border-slate-100 dark:border-slate-700 pb-3">
                        <div>
                            <span class="text-xs font-bold text-teal-600 dark:text-teal-400 uppercase tracking-wider">Day 2</span>
                            <h2 class="text-lg font-bold text-slate-800 dark:text-white">熊本自駕啟程</h2>
                        </div>
                        <div class="flex flex-col items-end space-y-1">
                            <div class="text-center bg-slate-100 dark:bg-slate-700 rounded p-1 min-w-[60px]">
                                <div class="text-xs text-slate-500 dark:text-slate-400">12/08</div>
                                <div class="text-sm font-bold text-teal-600 dark:text-teal-400 mb-1">週一</div>
                                <!-- Weather Widget -->
                                <div id="weather-day-2" class="text-xs text-slate-400 dark:text-slate-500 min-h-[1.5em] flex flex-col items-center justify-center">
                                    <i class="fas fa-circle-notch fa-spin"></i>
                                </div>
                            </div>
                            <!-- Route Button -->
                            <a href="https://www.google.com/maps/dir/?api=1&origin=TOYOTA+Rent-a-car+Hakata+Station+Front&destination=REF+Kumamoto+by+VESSEL+HOTELS&waypoints=二見浦+夫妻岩|熊本拉麵黑亭+熊本車站本店|高橋稻荷神社|一心堂老舖|長部田海床路|下通商店街|勝烈亭+新市街本店" target="_blank" class="text-[10px] bg-teal-50 dark:bg-teal-900/30 text-teal-600 dark:text-teal-300 px-2 py-1 rounded border border-teal-200 dark:border-teal-800 hover:bg-teal-100 dark:hover:bg-teal-800/50 transition-colors flex items-center">
                                <i class="fas fa-map-marked-alt mr-1"></i>查看路線
                            </a>
                        </div>
                    </div>

                    <div class="bg-blue-50 dark:bg-blue-900/20 text-blue-800 dark:text-blue-200 text-sm p-2 rounded mb-4">
                        <div class="flex items-center mb-1">
                            <i class="fas fa-car mr-2"></i>
                            <a href="https://maps.app.goo.gl/sWPhXktxDJMSSijc8" target="_blank" class="font-bold hover:underline">09:00 取車出發</a>
                        </div>
                        <div class="text-xs ml-6 opacity-80">TOYOTA Rent-a-car Hakata Station Front</div>
                    </div>
                    
                    <ul class="space-y-4">
                        <li class="flex items-center">
                            <i class="fas fa-mountain text-teal-500 dark:text-teal-400 mr-3"></i>
                            <a href="https://maps.app.goo.gl/6MjLtujdaFXnTDRS8" target="_blank" class="font-medium map-link text-blue-700 dark:text-blue-300">二見浦 夫妻岩</a>
                        </li>
                        <li class="flex items-center">
                            <i class="fas fa-utensils text-orange-400 mr-3"></i>
                            <div>
                                <a href="https://maps.app.goo.gl/NFx27VDvaSxzkVDw8" target="_blank" class="font-medium map-link text-blue-700 dark:text-blue-300">熊本拉麵黑亭</a>
                                <span class="text-xs text-slate-500 dark:text-slate-400 ml-2">(熊本車站本店)</span>
                            </div>
                        </li>
                        <li class="flex items-center opacity-75">
                            <i class="far fa-clock text-slate-400 dark:text-slate-500 mr-3"></i>
                            <a href="https://maps.app.goo.gl/fDZYh8HEjeiznoTeA" target="_blank" class="text-sm map-link hover:text-blue-600 dark:hover:text-blue-400 text-slate-600 dark:text-slate-400">高橋稻荷神社 (看時間)</a>
                        </li>
                        <li class="flex items-center">
                            <i class="fas fa-birthday-cake text-pink-400 mr-3"></i>
                            <div>
                                <a href="https://maps.app.goo.gl/KefpCg68X7rvZpLy8" target="_blank" class="font-medium map-link text-blue-700 dark:text-blue-300">一心堂老舖</a>
                                <span class="text-xs text-pink-500 ml-2">熊本最強甜點</span>
                            </div>
                        </li>
                        <li class="flex items-center">
                            <i class="fas fa-water text-blue-400 mr-3"></i>
                            <a href="https://maps.app.goo.gl/eMEBUR4nKK6YwyBGA" target="_blank" class="font-medium map-link text-blue-700 dark:text-blue-300">長部田海床路</a>
                        </li>
                        <li class="flex items-center">
                            <i class="fas fa-shopping-bag text-purple-400 mr-3"></i>
                            <a href="https://maps.app.goo.gl/NusoyAipzS5nT68Q7" target="_blank" class="font-medium map-link text-blue-700 dark:text-blue-300">下通商店街</a>
                        </li>
                        <li class="flex items-start bg-red-50 dark:bg-red-900/20 p-2 rounded-lg border border-red-100 dark:border-red-800/50">
                            <i class="fas fa-utensils mt-1 mr-3 text-red-500 dark:text-red-400"></i>
                            <div>
                                <a href="https://maps.app.goo.gl/6ntWCXQBA7WoexTt6" target="_blank" class="block font-bold text-red-600 dark:text-red-300 map-link">勝烈亭 新市街本店</a>
                                <span class="inline-block bg-red-500 text-white text-xs px-2 py-0.5 rounded mt-1 dark:bg-red-600">現場排隊</span>
                            </div>
                        </li>
                    </ul>
                </div>
                <!-- Hotel -->
                <div class="bg-slate-50 dark:bg-slate-700/50 p-4 border-t border-slate-100 dark:border-slate-700">
                    <div class="flex items-center bg-slate-800 dark:bg-slate-900 p-2 rounded-lg text-white shadow-sm">
                        <i class="fas fa-bed text-indigo-300 mr-3"></i>
                        <a href="https://maps.app.goo.gl/RkXNSz5Tgg8PdM289" target="_blank" class="font-medium text-sm hover:text-indigo-200 transition-colors">REF Kumamoto by VESSEL HOTELS</a>
                    </div>
                </div>
            </div>

            <!-- Day 3 -->
            <div id="day-3" class="scroll-mt-24 bg-white dark:bg-slate-800 rounded-xl shadow-md overflow-hidden hover:shadow-xl hover:-translate-y-1 transition-all duration-300 border-t-4 border-indigo-500 dark:border-indigo-600 flex flex-col">
                <div class="p-5 flex-1">
                    <div class="flex justify-between items-start mb-4 border-b border-slate-100 dark:border-slate-700 pb-3">
                        <div>
                            <span class="text-xs font-bold text-indigo-600 dark:text-indigo-400 uppercase tracking-wider">Day 3</span>
                            <h2 class="text-lg font-bold text-slate-800 dark:text-white">熊本市區巡禮</h2>
                        </div>
                        <div class="flex flex-col items-end space-y-1">
                            <div class="text-center bg-slate-100 dark:bg-slate-700 rounded p-1 min-w-[60px]">
                                <div class="text-xs text-slate-500 dark:text-slate-400">12/09</div>
                                <div class="text-sm font-bold text-indigo-600 dark:text-indigo-400 mb-1">週二</div>
                                <!-- Weather Widget -->
                                <div id="weather-day-3" class="text-xs text-slate-400 dark:text-slate-500 min-h-[1.5em] flex flex-col items-center justify-center">
                                    <i class="fas fa-circle-notch fa-spin"></i>
                                </div>
                            </div>
                            <!-- Route Button -->
                            <a href="https://www.google.com/maps/dir/?api=1&origin=REF+Kumamoto+by+VESSEL+HOTELS&destination=REF+Kumamoto+by+VESSEL+HOTELS&waypoints=熊本城|櫻花馬場+城彩苑|水前寺成趣園|熊本縣廳銀杏大道|Mekkemon+Sushi+熊本車站" target="_blank" class="text-[10px] bg-indigo-50 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-300 px-2 py-1 rounded border border-indigo-200 dark:border-indigo-800 hover:bg-indigo-100 dark:hover:bg-indigo-800/50 transition-colors flex items-center">
                                <i class="fas fa-map-marked-alt mr-1"></i>查看路線
                            </a>
                        </div>
                    </div>
                    
                    <ul class="space-y-3">
                        <li class="bg-slate-50 dark:bg-slate-700/50 p-3 rounded-lg flex items-center">
                            <i class="fas fa-chess-rook text-slate-600 dark:text-slate-400 mr-3 w-5 text-center"></i>
                            <a href="https://maps.app.goo.gl/6eWUz3LgsRAumbM96" target="_blank" class="font-medium map-link text-blue-700 dark:text-blue-300">熊本城 / 加藤神社</a>
                        </li>
                        <li class="bg-slate-50 dark:bg-slate-700/50 p-3 rounded-lg flex items-center">
                            <i class="fas fa-store text-slate-600 dark:text-slate-400 mr-3 w-5 text-center"></i>
                            <a href="https://maps.app.goo.gl/DiU9j8JK8uStfze96" target="_blank" class="font-medium map-link text-blue-700 dark:text-blue-300">櫻花馬場 城彩苑</a>
                        </li>
                        <li class="bg-slate-50 dark:bg-slate-700/50 p-3 rounded-lg flex items-center">
                            <i class="fas fa-tree text-green-600 dark:text-green-400 mr-3 w-5 text-center"></i>
                            <a href="https://maps.app.goo.gl/A1qooYsxjvcUYxUw6" target="_blank" class="font-medium map-link text-blue-700 dark:text-blue-300">水前寺成趣園</a>
                        </li>
                        <li class="bg-slate-50 dark:bg-slate-700/50 p-3 rounded-lg flex items-center">
                            <i class="fas fa-anchor text-yellow-600 dark:text-yellow-500 mr-3 w-5 text-center"></i>
                            <div>
                                <a href="https://maps.app.goo.gl/C754b5ei5NBgqjiU6" target="_blank" class="font-medium map-link text-blue-700 dark:text-blue-300">熊本縣廳銀杏大道</a>
                                <span class="block text-xs text-slate-500 dark:text-slate-400">魯夫銅像朝聖</span>
                            </div>
                        </li>
                        <li class="bg-slate-50 dark:bg-slate-700/50 p-3 rounded-lg flex items-center border-l-4 border-orange-400">
                            <i class="fas fa-fish text-orange-400 mr-3 w-5 text-center"></i>
                            <a href="https://maps.app.goo.gl/HPntYLthRf4ju7GYA" target="_blank" class="font-medium map-link text-blue-700 dark:text-blue-300">Mekkemon Sushi (熊本車站)</a>
                        </li>
                    </ul>
                </div>
                <!-- Hotel -->
                <div class="bg-slate-50 dark:bg-slate-700/50 p-4 border-t border-slate-100 dark:border-slate-700">
                    <div class="flex items-center bg-slate-800 dark:bg-slate-900 p-2 rounded-lg text-white shadow-sm">
                        <i class="fas fa-bed text-indigo-300 mr-3"></i>
                        <a href="https://maps.app.goo.gl/RkXNSz5Tgg8PdM289" target="_blank" class="font-medium text-sm hover:text-indigo-200 transition-colors">REF Kumamoto by VESSEL HOTELS</a>
                    </div>
                </div>
            </div>

            <!-- Day 4 -->
            <div id="day-4" class="scroll-mt-24 bg-white dark:bg-slate-800 rounded-xl shadow-md overflow-hidden hover:shadow-xl hover:-translate-y-1 transition-all duration-300 border-t-4 border-green-500 dark:border-green-600 flex flex-col">
                <div class="p-5 flex-1">
                    <div class="flex justify-between items-start mb-4 border-b border-slate-100 dark:border-slate-700 pb-3">
                        <div>
                            <span class="text-xs font-bold text-green-600 dark:text-green-400 uppercase tracking-wider">Day 4</span>
                            <h2 class="text-lg font-bold text-slate-800 dark:text-white">阿蘇火山絕景</h2>
                        </div>
                        <div class="flex flex-col items-end space-y-1">
                            <div class="text-center bg-slate-100 dark:bg-slate-700 rounded p-1 min-w-[60px]">
                                <div class="text-xs text-slate-500 dark:text-slate-400">12/10</div>
                                <div class="text-sm font-bold text-green-600 dark:text-green-400 mb-1">週三</div>
                                <!-- Weather Widget -->
                                <div id="weather-day-4" class="text-xs text-slate-400 dark:text-slate-500 min-h-[1.5em] flex flex-col items-center justify-center">
                                    <i class="fas fa-circle-notch fa-spin"></i>
                                </div>
                            </div>
                            <!-- Route Button -->
                            <a href="https://www.google.com/maps/dir/?api=1&origin=REF+Kumamoto+by+VESSEL+HOTELS&destination=熊本阿蘇萬楓酒店&waypoints=阿蘇車站|草千里|阿蘇火山口|阿蘇+いまきん食堂|阿蘇菓子工房|阿蘇神社|阿蘇坊中溫泉+夢之湯|阿蘇+和樂" target="_blank" class="text-[10px] bg-green-50 dark:bg-green-900/30 text-green-600 dark:text-green-300 px-2 py-1 rounded border border-green-200 dark:border-green-800 hover:bg-green-100 dark:hover:bg-green-800/50 transition-colors flex items-center">
                                <i class="fas fa-map-marked-alt mr-1"></i>查看路線
                            </a>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 gap-2">
                        <div class="flex items-center p-2">
                            <i class="fas fa-train text-slate-500 dark:text-slate-400 mr-3"></i>
                            <a href="https://maps.app.goo.gl/CnRG9Jt8D4gwzRcw8" target="_blank" class="font-medium map-link text-blue-700 dark:text-blue-300">阿蘇車站</a>
                        </div>

                        <a href="https://maps.app.goo.gl/8sXirUAFjijtg4RP7" target="_blank" class="block relative overflow-hidden rounded-lg bg-green-50 dark:bg-green-900/20 p-3 hover:bg-green-100 dark:hover:bg-green-800/30 transition-colors">
                            <div class="absolute top-0 right-0 -mt-2 -mr-2 w-12 h-12 bg-green-200 dark:bg-green-800 rounded-full opacity-50"></div>
                            <div class="font-bold text-green-800 dark:text-green-200 mb-1">草千里</div>
                            <div class="text-xs text-green-700 dark:text-green-300">壯闊草原風光</div>
                        </a>

                        <div class="flex items-center p-2">
                            <i class="fas fa-mountain text-gray-500 dark:text-gray-400 mr-3"></i>
                            <a href="https://maps.app.goo.gl/JArp9gxLbBJTMAveA" target="_blank" class="font-medium map-link text-blue-700 dark:text-blue-300">阿蘇火山口</a>
                        </div>

                        <div class="flex items-center p-2 bg-orange-50 dark:bg-orange-900/20 rounded border border-orange-100 dark:border-orange-800/50">
                            <i class="fas fa-utensils text-orange-500 mr-3"></i>
                            <a href="https://maps.app.goo.gl/DricqDS3KQ9VFDzk8" target="_blank" class="font-bold text-orange-800 dark:text-orange-200 map-link">赤牛丼 (必吃)</a>
                        </div>

                        <div class="flex items-center p-2">
                            <i class="fas fa-cookie-bite text-pink-400 mr-3"></i>
                            <a href="https://maps.app.goo.gl/9nTzWagpVixr6JQ66" target="_blank" class="font-medium map-link text-blue-700 dark:text-blue-300">阿蘇菓子工房</a>
                        </div>

                        <div class="flex items-center p-2 opacity-75">
                            <i class="far fa-clock text-slate-400 dark:text-slate-500 mr-3"></i>
                            <a href="https://maps.app.goo.gl/TuwaJBv7Z7jgnYgJ9" target="_blank" class="text-sm map-link hover:text-blue-600 dark:hover:text-blue-400 text-slate-600 dark:text-slate-400">阿蘇牛奶冰淇淋/可麗餅 (看時間)</a>
                        </div>

                        <div class="flex items-center p-2">
                            <i class="fas fa-torii-gate text-red-400 mr-3"></i>
                            <a href="https://maps.app.goo.gl/zMbXyCh3PRVaAPJF9" target="_blank" class="font-medium map-link text-blue-700 dark:text-blue-300">阿蘇神社</a>
                        </div>

                        <div class="flex items-center p-2 bg-blue-50 dark:bg-blue-900/20 rounded border border-blue-100 dark:border-blue-800/50">
                            <i class="fas fa-hot-tub text-blue-500 mr-3"></i>
                            <div>
                                <a href="https://maps.app.goo.gl/SyQzqL2JYopsHTja7" target="_blank" class="font-medium map-link text-blue-700 dark:text-blue-300">阿蘇坊中溫泉 夢之湯</a>
                                <span class="text-xs text-blue-600 dark:text-blue-400 block">家庭池</span>
                            </div>
                        </div>

                        <div class="flex items-start bg-red-50 dark:bg-red-900/20 p-2 rounded-lg border border-red-100 dark:border-red-800/50 mt-2">
                            <i class="fas fa-utensils mt-1 mr-3 text-red-500 dark:text-red-400"></i>
                            <div>
                                <a href="https://maps.app.goo.gl/LyJGjstXWS6dptw87" target="_blank" class="block font-bold text-red-600 dark:text-red-300 map-link">和樂</a>
                                <span class="inline-block bg-red-500 text-white text-xs px-2 py-0.5 rounded mt-1 dark:bg-red-600">現場排隊</span>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Hotel -->
                <div class="bg-slate-50 dark:bg-slate-700/50 p-4 border-t border-slate-100 dark:border-slate-700">
                    <div class="flex items-center bg-slate-800 dark:bg-slate-900 p-2 rounded-lg text-white shadow-sm">
                        <i class="fas fa-bed text-indigo-300 mr-3"></i>
                        <a href="https://maps.app.goo.gl/uAW2XyxWVCgaMXKw6" target="_blank" class="font-medium text-sm hover:text-indigo-200 transition-colors">熊本阿蘇萬楓酒店</a>
                    </div>
                </div>
            </div>

            <!-- Day 5 -->
            <div id="day-5" class="scroll-mt-24 bg-white dark:bg-slate-800 rounded-xl shadow-md overflow-hidden hover:shadow-xl hover:-translate-y-1 transition-all duration-300 border-t-4 border-cyan-500 dark:border-cyan-600 relative flex flex-col">
                <div class="absolute top-0 right-0 bg-red-500 text-white text-xs px-2 py-1 rounded-bl">早起注意</div>
                <div class="p-5 flex-1">
                    <div class="flex justify-between items-start mb-4 border-b border-slate-100 dark:border-slate-700 pb-3">
                        <div>
                            <span class="text-xs font-bold text-cyan-600 dark:text-cyan-400 uppercase tracking-wider">Day 5</span>
                            <h2 class="text-lg font-bold text-slate-800 dark:text-white">高千穗神話</h2>
                        </div>
                        <div class="flex flex-col items-end space-y-1">
                            <div class="text-center bg-slate-100 dark:bg-slate-700 rounded p-1 min-w-[60px]">
                                <div class="text-xs text-slate-500 dark:text-slate-400">12/11</div>
                                <div class="text-sm font-bold text-cyan-600 dark:text-cyan-400 mb-1">週四</div>
                                <!-- Weather Widget -->
                                <div id="weather-day-5" class="text-xs text-slate-400 dark:text-slate-500 min-h-[1.5em] flex flex-col items-center justify-center">
                                    <i class="fas fa-circle-notch fa-spin"></i>
                                </div>
                            </div>
                            <!-- Route Button -->
                            <a href="https://www.google.com/maps/dir/?api=1&origin=熊本阿蘇萬楓酒店&destination=由布院UBL飯店&waypoints=高千穗峽|千穂之家+元祖流水麵|高千穗牛燒肉+和|高千穗神社|白川水源|上色見熊野座神社|高千穗+CARNE" target="_blank" class="text-[10px] bg-cyan-50 dark:bg-cyan-900/30 text-cyan-600 dark:text-cyan-300 px-2 py-1 rounded border border-cyan-200 dark:border-cyan-800 hover:bg-cyan-100 dark:hover:bg-cyan-800/50 transition-colors flex items-center">
                                <i class="fas fa-map-marked-alt mr-1"></i>查看路線
                            </a>
                        </div>
                    </div>

                    <div class="bg-red-50 dark:bg-red-900/20 text-red-800 dark:text-red-200 p-3 rounded-lg mb-4 text-center border border-red-200 dark:border-red-800/50 shadow-sm">
                        <i class="fas fa-alarm-clock mr-1 animate-bounce"></i>
                        <span class="font-bold text-lg">07:30 出門</span>
                    </div>

                    <ul class="space-y-4">
                        <li class="bg-cyan-50 dark:bg-cyan-900/20 p-2 rounded border border-cyan-200 dark:border-cyan-800/50">
                            <div class="flex justify-between items-center">
                                <a href="https://maps.app.goo.gl/JrVbgbt6wenKS4mg7" target="_blank" class="font-bold text-cyan-900 dark:text-cyan-100 map-link">高千穗峽</a>
                                <span class="bg-cyan-600 text-white text-xs px-2 py-1 rounded">10:30</span>
                            </div>
                        </li>
                        <li class="flex items-center">
                            <i class="fas fa-water text-blue-400 mr-3"></i>
                            <a href="https://maps.app.goo.gl/v6JrqtgbFZx2XpR2A" target="_blank" class="map-link text-blue-700 dark:text-blue-300">千穂之家 元祖流水麵</a>
                        </li>
                        <li class="flex items-center">
                            <i class="fas fa-fire text-red-400 mr-3"></i>
                            <a href="https://maps.app.goo.gl/b4UdHKEG13kWZU3TA" target="_blank" class="font-medium map-link text-blue-700 dark:text-blue-300">高千穗牛燒肉 和</a>
                        </li>
                        <li class="flex items-center">
                            <i class="fas fa-torii-gate text-slate-600 dark:text-slate-400 mr-3"></i>
                            <a href="https://maps.app.goo.gl/dgZbgueSiBwQNyw3A" target="_blank" class="map-link text-blue-700 dark:text-blue-300">高千穗神社</a>
                        </li>
                        <li class="flex items-center">
                            <i class="fas fa-tint text-blue-500 mr-3"></i>
                            <a href="https://maps.app.goo.gl/L5fi7LKsCN22QDVy6" target="_blank" class="map-link text-blue-700 dark:text-blue-300">白川水源</a>
                        </li>
                        <li class="flex items-center opacity-75">
                            <i class="far fa-clock text-slate-400 dark:text-slate-500 mr-3"></i>
                            <a href="https://maps.app.goo.gl/6JN7SXAhEMiye8V87" target="_blank" class="text-sm map-link hover:text-blue-600 dark:hover:text-blue-400 text-slate-600 dark:text-slate-400">上色見熊野座神社 (看時間)</a>
                        </li>
                        <li class="flex items-start bg-red-50 dark:bg-red-900/20 p-2 rounded-lg border border-red-100 dark:border-red-800/50">
                            <i class="fas fa-drumstick-bite mt-1 mr-3 text-red-500 dark:text-red-400"></i>
                            <div>
                                <a href="https://maps.app.goo.gl/udFyBnYm7m46Vqbv7" target="_blank" class="block font-bold text-red-600 dark:text-red-300 map-link">CARNE (雞肉串)</a>
                                <span class="inline-block bg-red-500 text-white text-xs px-2 py-0.5 rounded mt-1 dark:bg-red-600">19:30 訂位</span>
                            </div>
                        </li>
                    </ul>
                </div>
                <!-- Hotel -->
                <div class="bg-slate-50 dark:bg-slate-700/50 p-4 border-t border-slate-100 dark:border-slate-700">
                    <div class="flex items-center bg-slate-800 dark:bg-slate-900 p-2 rounded-lg text-white shadow-sm">
                        <i class="fas fa-bed text-indigo-300 mr-3"></i>
                        <a href="https://maps.app.goo.gl/v6SBJDuNe9toRe288" target="_blank" class="font-medium text-sm hover:text-indigo-200 transition-colors">由布院UBL飯店</a>
                    </div>
                </div>
            </div>

            <!-- Day 6 -->
            <div id="day-6" class="scroll-mt-24 bg-white dark:bg-slate-800 rounded-xl shadow-md overflow-hidden hover:shadow-xl hover:-translate-y-1 transition-all duration-300 border-t-4 border-pink-500 dark:border-pink-600 flex flex-col">
                <div class="p-5 flex-1">
                    <div class="flex justify-between items-start mb-4 border-b border-slate-100 dark:border-slate-700 pb-3">
                        <div>
                            <span class="text-xs font-bold text-pink-600 dark:text-pink-400 uppercase tracking-wider">Day 6</span>
                            <h2 class="text-lg font-bold text-slate-800 dark:text-white">由布院漫步</h2>
                        </div>
                        <div class="flex flex-col items-end space-y-1">
                            <div class="text-center bg-slate-100 dark:bg-slate-700 rounded p-1 min-w-[60px]">
                                <div class="text-xs text-slate-500 dark:text-slate-400">12/12</div>
                                <div class="text-sm font-bold text-pink-600 dark:text-pink-400 mb-1">週五</div>
                                <!-- Weather Widget -->
                                <div id="weather-day-6" class="text-xs text-slate-400 dark:text-slate-500 min-h-[1.5em] flex flex-col items-center justify-center">
                                    <i class="fas fa-circle-notch fa-spin"></i>
                                </div>
                            </div>
                            <!-- Route Button -->
                            <a href="https://www.google.com/maps/dir/?api=1&origin=由布院UBL飯店&destination=福岡天神東方快捷飯店&waypoints=金鱗湖|由布釜飯+心+金鱗湖本店|湯布院花卉村|蛋糕卷+B+SPEAK+本店|宇奈岐日女神社|和牛専門店+YUFUYA" target="_blank" class="text-[10px] bg-pink-50 dark:bg-pink-900/30 text-pink-600 dark:text-pink-300 px-2 py-1 rounded border border-pink-200 dark:border-pink-800 hover:bg-pink-100 dark:hover:bg-pink-800/50 transition-colors flex items-center">
                                <i class="fas fa-map-marked-alt mr-1"></i>查看路線
                            </a>
                        </div>
                    </div>
                    
                    <ul class="space-y-4">
                        <li class="flex items-center">
                            <div class="w-2 h-2 bg-pink-300 rounded-full mr-3"></div>
                            <a href="https://maps.app.goo.gl/PPcU3ZpCkK3jDxsZ6" target="_blank" class="font-medium map-link text-blue-700 dark:text-blue-300">金鱗湖</a>
                        </li>
                        <li class="bg-orange-50 dark:bg-orange-900/20 p-2 rounded-lg flex items-center border border-orange-100 dark:border-orange-800/50">
                            <i class="fas fa-utensils text-orange-500 mr-3"></i>
                            <a href="https://maps.app.goo.gl/2SMepXnHYUPEVCTaA" target="_blank" class="font-bold text-slate-800 dark:text-slate-200 map-link">由布釜飯「心」</a>
                            <span class="text-xs text-slate-500 dark:text-slate-400 ml-auto">金鱗湖本店</span>
                        </li>
                        
                        <!-- Combined Floral Village Group -->
                        <li class="bg-pink-50 dark:bg-pink-900/20 rounded-lg p-3 border border-pink-100 dark:border-pink-800/50">
                            <div class="flex items-center mb-2">
                                <i class="fas fa-store text-pink-500 mr-2"></i>
                                <a href="https://maps.app.goo.gl/TqLhBCXyZ7X37wgr6" target="_blank" class="font-bold text-pink-900 dark:text-pink-200 map-link">湯布院花卉村 & 周邊</a>
                            </div>
                            <ul class="space-y-2 pl-2">
                                <li class="flex items-center text-sm">
                                    <i class="fas fa-angle-right text-pink-300 mr-2"></i>
                                    <a href="https://maps.app.goo.gl/dWCWA1sS656MDKMZA" target="_blank" class="map-link hover:text-pink-600 dark:hover:text-pink-300 text-slate-600 dark:text-slate-300">中津からあげ専門店 吉吾</a>
                                </li>
                                <li class="flex items-center text-sm">
                                    <i class="fas fa-angle-right text-pink-300 mr-2"></i>
                                    <a href="https://maps.app.goo.gl/rqdG8bRSMzJtRAEn8" target="_blank" class="map-link hover:text-pink-600 dark:hover:text-pink-300 text-slate-600 dark:text-slate-300">由布院 Milch 布丁</a>
                                </li>
                                <li class="flex items-center text-sm">
                                    <i class="fas fa-angle-right text-pink-300 mr-2"></i>
                                    <a href="https://maps.app.goo.gl/1vUzTZeDMVbZpU3MA" target="_blank" class="map-link hover:text-pink-600 dark:hover:text-pink-300 text-slate-600 dark:text-slate-300">花麴菊家 (布丁銅鑼燒)</a>
                                </li>
                                <li class="flex items-center text-sm">
                                    <i class="fas fa-angle-right text-pink-300 mr-2"></i>
                                    <a href="https://maps.app.goo.gl/J4HA8aavFwX224Hn9" target="_blank" class="map-link hover:text-pink-600 dark:hover:text-pink-300 text-slate-600 dark:text-slate-300">手打蕎麥麵 泉 (金鱗湖店)</a>
                                </li>
                                <li class="flex items-center text-sm">
                                    <i class="fas fa-angle-right text-pink-300 mr-2"></i>
                                    <a href="https://maps.app.goo.gl/KGHwPZr6cuJ6AuUs6" target="_blank" class="map-link hover:text-pink-600 dark:hover:text-pink-300 text-slate-600 dark:text-slate-300">金賞可樂餅 本店</a>
                                </li>
                            </ul>
                        </li>

                        <li class="flex items-center bg-yellow-50 dark:bg-yellow-900/20 p-2 rounded">
                            <i class="fas fa-birthday-cake text-pink-500 mr-3"></i>
                            <a href="https://maps.app.goo.gl/UDHPtws1S3AkUoZC8" target="_blank" class="font-medium map-link text-blue-700 dark:text-blue-300">蛋糕卷 B SPEAK 本店</a>
                        </li>
                        <li class="flex items-center opacity-75">
                            <i class="far fa-clock text-slate-400 dark:text-slate-500 mr-3"></i>
                            <a href="https://maps.app.goo.gl/qkAeSkiHxZxL6YpQ6" target="_blank" class="text-sm map-link hover:text-blue-600 dark:hover:text-blue-400 text-slate-600 dark:text-slate-400">宇奈岐日女神社 (看時間)</a>
                        </li>
                        <li class="flex items-start bg-red-50 dark:bg-red-900/20 p-2 rounded-lg border border-red-100 dark:border-red-800/50">
                            <i class="fas fa-utensils mt-1 mr-3 text-red-500 dark:text-red-400"></i>
                            <div>
                                <a href="https://maps.app.goo.gl/K6aH3P1Tqy98HGoB8" target="_blank" class="block font-bold text-red-600 dark:text-red-300 map-link">和牛専門店 YUFUYA</a>
                                <span class="inline-block bg-red-500 text-white text-xs px-2 py-0.5 rounded mt-1 dark:bg-red-600">17:30 訂位</span>
                            </div>
                        </li>
                    </ul>
                </div>
                <!-- Hotel -->
                <div class="bg-slate-50 dark:bg-slate-700/50 p-4 border-t border-slate-100 dark:border-slate-700">
                    <div class="flex items-center bg-slate-800 dark:bg-slate-900 p-2 rounded-lg text-white shadow-sm">
                        <i class="fas fa-bed text-indigo-300 mr-3"></i>
                        <a href="https://maps.app.goo.gl/t9TPvdYHwE3yni8DA" target="_blank" class="font-medium text-sm hover:text-indigo-200 transition-colors">福岡天神東方快捷飯店</a>
                    </div>
                </div>
            </div>

            <!-- Day 7 -->
            <div id="day-7" class="scroll-mt-24 bg-white dark:bg-slate-800 rounded-xl shadow-md overflow-hidden hover:shadow-xl hover:-translate-y-1 transition-all duration-300 border-t-4 border-purple-500 dark:border-purple-600 flex flex-col">
                <div class="p-5 flex-1">
                    <div class="flex justify-between items-start mb-4 border-b border-slate-100 dark:border-slate-700 pb-3">
                        <div>
                            <span class="text-xs font-bold text-purple-600 dark:text-purple-400 uppercase tracking-wider">Day 7</span>
                            <h2 class="text-lg font-bold text-slate-800 dark:text-white">博多美食</h2>
                        </div>
                        <div class="text-center bg-slate-100 dark:bg-slate-700 rounded p-1 min-w-[60px]">
                            <div class="text-xs text-slate-500 dark:text-slate-400">12/13</div>
                            <div class="text-sm font-bold text-purple-600 dark:text-purple-400 mb-1">週六</div>
                            <!-- Weather Widget -->
                            <div id="weather-day-7" class="text-xs text-slate-400 dark:text-slate-500 min-h-[1.5em] flex flex-col items-center justify-center">
                                <i class="fas fa-circle-notch fa-spin"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex flex-col h-full">
                        <div class="bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-300 text-sm p-2 rounded mb-4 border border-slate-200 dark:border-slate-600">
                            <div class="flex items-center mb-1">
                                <i class="fas fa-car mr-2 text-slate-500 dark:text-slate-400"></i>
                                <a href="https://maps.app.goo.gl/sWPhXktxDJMSSijc8" target="_blank" class="font-bold hover:underline">08:00 還車</a>
                            </div>
                            <div class="text-xs ml-6 text-slate-500 dark:text-slate-400">TOYOTA Rent-a-car Hakata Station Front</div>
                        </div>

                        <div class="text-sm text-slate-500 dark:text-slate-400 italic mb-2">福岡市區 / 購物 / 最後採買</div>
                        
                        <div class="flex items-start bg-red-50 dark:bg-red-900/20 p-2 rounded-lg border border-red-100 dark:border-red-800/50 mb-4">
                            <i class="fas fa-utensils mt-1 mr-3 text-red-500 dark:text-red-400"></i>
                            <div>
                                <a href="https://maps.app.goo.gl/Avbrgt527Hg2qbHH9" target="_blank" class="block font-bold text-red-600 dark:text-red-300 map-link">博多牛腸鍋 前田屋</a>
                                <span class="inline-block bg-red-500 text-white text-xs px-2 py-0.5 rounded mt-1 dark:bg-red-600">22:00 訂位</span>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Hotel -->
                <div class="bg-slate-50 dark:bg-slate-700/50 p-4 border-t border-slate-100 dark:border-slate-700">
                    <div class="flex items-center bg-slate-800 dark:bg-slate-900 p-2 rounded-lg text-white shadow-sm">
                        <i class="fas fa-bed text-indigo-300 mr-3"></i>
                        <a href="https://maps.app.goo.gl/t9TPvdYHwE3yni8DA" target="_blank" class="font-medium text-sm hover:text-indigo-200 transition-colors">福岡天神東方快捷飯店</a>
                    </div>
                </div>
            </div>

             <!-- Day 8 -->
             <div id="day-8" class="scroll-mt-24 bg-white dark:bg-slate-800 rounded-xl shadow-md overflow-hidden hover:shadow-xl hover:-translate-y-1 transition-all duration-300 border-t-4 border-slate-500 dark:border-slate-600 flex flex-col">
                <div class="p-5 flex-1">
                    <div class="flex justify-between items-start mb-4 border-b border-slate-100 dark:border-slate-700 pb-3">
                        <div>
                            <span class="text-xs font-bold text-slate-600 dark:text-slate-400 uppercase tracking-wider">Day 8</span>
                            <h2 class="text-lg font-bold text-slate-800 dark:text-white">回程 / 美食</h2>
                        </div>
                        <div class="text-center bg-slate-100 dark:bg-slate-700 rounded p-1 min-w-[60px]">
                            <div class="text-xs text-slate-500 dark:text-slate-400">12/14</div>
                            <div class="text-sm font-bold text-slate-600 dark:text-slate-400 mb-1">週日</div>
                            <!-- Weather Widget -->
                            <div id="weather-day-8" class="text-xs text-slate-400 dark:text-slate-500 min-h-[1.5em] flex flex-col items-center justify-center">
                                <i class="fas fa-circle-notch fa-spin"></i>
                            </div>
                        </div>
                    </div>

                    <ul class="space-y-4">
                        <li class="flex items-start bg-red-50 dark:bg-red-900/20 p-2 rounded-lg border border-red-100 dark:border-red-800/50">
                           <i class="fas fa-utensils mt-1 mr-3 text-red-500 dark:text-red-400"></i>
                           <div>
                               <a href="https://maps.app.goo.gl/3qnnCcXogBFvyJCL7" target="_blank" class="block font-bold text-red-600 dark:text-red-300 map-link">博多水炊鍋専門 橙</a>
                               <span class="inline-block bg-red-500 text-white text-xs px-2 py-0.5 rounded mt-1 dark:bg-red-600">現場排隊</span>
                           </div>
                       </li>
                        <li class="flex items-start bg-slate-100 dark:bg-slate-700 p-2 rounded-lg border border-slate-200 dark:border-slate-600">
                           <i class="fas fa-plane-departure mt-1 mr-3 text-slate-600 dark:text-slate-400"></i>
                           <div>
                               <span class="block font-bold text-slate-800 dark:text-slate-200">AK1511 返回 (吳沛揚)</span>
                               <span class="text-xs text-slate-600 dark:text-slate-400">18:00 - 19:30</span>
                           </div>
                       </li>
                        <li class="flex items-start bg-slate-100 dark:bg-slate-700 p-2 rounded-lg border border-slate-200 dark:border-slate-600">
                           <i class="fas fa-plane-departure mt-1 mr-3 text-slate-600 dark:text-slate-400"></i>
                           <div>
                               <span class="block font-bold text-slate-800 dark:text-slate-200">BR101 返回</span>
                               <span class="text-xs text-slate-600 dark:text-slate-400">20:55 - 22:40</span>
                           </div>
                       </li>
                   </ul>
                </div>
            </div>

        </div>

        <div class="mt-8 text-center text-xs text-slate-400 pb-10">
            <p>行程僅供參考，請依實際路況調整。</p>
        </div>
    </div>

    <!-- AI Assistant Floating Button -->
    <button id="ai-assistant-btn" class="fixed bottom-6 right-6 w-14 h-14 bg-gradient-to-r from-indigo-500 to-purple-600 text-white rounded-full shadow-lg hover:shadow-2xl hover:scale-105 transition-all duration-300 flex items-center justify-center z-50 group">
        <i class="fas fa-robot text-2xl group-hover:rotate-12 transition-transform"></i>
        <div class="absolute -top-1 -right-1 w-4 h-4 bg-red-500 rounded-full animate-pulse border-2 border-white"></div>
        <div class="absolute -top-10 right-0 bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-200 text-xs px-2 py-1 rounded shadow-md opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap">
            行程小幫手
        </div>
    </button>

    <!-- AI Chat Modal -->
    <div id="ai-chat-modal" class="fixed bottom-24 right-6 w-[90vw] md:w-[400px] h-[70vh] md:h-[500px] bg-white dark:bg-slate-800 rounded-2xl shadow-2xl z-50 hidden flex flex-col overflow-hidden border border-slate-100 dark:border-slate-700">
        <!-- Header -->
        <div class="bg-gradient-to-r from-indigo-500 to-purple-600 p-4 text-white flex justify-between items-center shrink-0">
            <div class="flex items-center">
                <div class="w-8 h-8 bg-white/20 rounded-full flex items-center justify-center mr-2">
                    <i class="fas fa-sparkles text-yellow-300"></i>
                </div>
                <div>
                    <h3 class="font-bold">✨ 福岡旅遊 AI 導遊</h3>
                    <p class="text-xs text-indigo-100">已讀取您的 8 天行程與天氣</p>
                </div>
            </div>
            <div class="flex items-center space-x-2">
                <button id="settings-btn" class="text-white/80 hover:text-white hover:bg-white/10 rounded-full w-8 h-8 flex items-center justify-center transition-colors">
                    <i class="fas fa-cog"></i>
                </button>
                <button id="close-chat-btn" class="text-white/80 hover:text-white hover:bg-white/10 rounded-full w-8 h-8 flex items-center justify-center transition-colors">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
        
        <!-- Settings Panel (Hidden by default) -->
        <div id="settings-panel" class="hidden absolute top-[64px] left-0 w-full h-[calc(100%-64px)] bg-slate-50 dark:bg-slate-900 z-10 p-4 flex flex-col">
            <h4 class="font-bold text-slate-700 dark:text-slate-200 mb-4 flex items-center"><i class="fas fa-key mr-2 text-indigo-500"></i>設定 API 金鑰</h4>
            <div class="bg-white dark:bg-slate-800 p-4 rounded-xl shadow-sm border border-slate-200 dark:border-slate-700 mb-4">
                <p class="text-xs text-slate-500 dark:text-slate-400 mb-2">為了在下載後或旅行中能持續使用 AI 功能，請輸入您的 Google Gemini API Key。</p>
                <!-- Change type="password" to type="text" here -->
                <input type="text" id="api-key-input" class="w-full bg-slate-50 dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded px-3 py-2 text-sm focus:border-indigo-500 outline-none mb-3 text-slate-700 dark:text-slate-200" placeholder="貼上您的 API Key">
                <div class="flex items-center justify-between">
                     <a href="https://aistudio.google.com/app/apikey" target="_blank" class="text-xs text-indigo-500 hover:underline">取得免費 Key <i class="fas fa-external-link-alt ml-1"></i></a>
                    <button id="save-key-btn" class="bg-indigo-600 text-white px-4 py-2 rounded text-sm hover:bg-indigo-700 transition-colors">儲存</button>
                </div>
            </div>
            <div class="mt-auto text-center">
                <button id="close-settings-btn" class="text-slate-400 text-sm hover:text-slate-600 dark:hover:text-slate-300">返回聊天</button>
            </div>
        </div>

        <!-- Messages Area -->
        <div id="chat-messages" class="flex-1 min-h-0 overflow-y-auto p-4 space-y-4 bg-slate-50 dark:bg-slate-900 scroll-smooth overscroll-contain pb-4">
            <!-- Intro Message -->
            <div class="flex items-start">
                <div class="w-8 h-8 rounded-full bg-indigo-100 dark:bg-indigo-900/50 flex items-center justify-center mr-2 shrink-0 border border-indigo-200 dark:border-indigo-700">
                    <i class="fas fa-robot text-indigo-500 dark:text-indigo-300 text-xs"></i>
                </div>
                <div class="bg-white dark:bg-slate-800 p-3 rounded-2xl rounded-tl-none shadow-sm text-sm border border-slate-100 dark:border-slate-700 max-w-[85%] text-slate-700 dark:text-slate-200">
                    <p class="mb-2">您好！我是您的福岡專屬 AI 導遊 🤖</p>
                    <p>我已經記住您的所有行程和當地天氣了！無論是想找附近的便利商店、查詢穿搭建議，或是需要日文翻譯，隨時都可以問我喔！</p>
                </div>
            </div>
        </div>

        <!-- Preset Chips -->
        <div class="px-4 py-2 bg-white dark:bg-slate-800 border-t border-slate-100 dark:border-slate-700 flex gap-2 overflow-x-auto shrink-0 scrollbar-hide">
            <button class="preset-btn whitespace-nowrap px-3 py-1 bg-indigo-50 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-300 rounded-full text-xs font-medium hover:bg-indigo-100 dark:hover:bg-indigo-800/50 transition-colors border border-indigo-100 dark:border-indigo-800" data-prompt="幫我估算這趟旅程除了機票住宿外，大概還需要準備多少日幣現金？請列出細項估算。">
                💰 預算估算
            </button>
            <button class="preset-btn whitespace-nowrap px-3 py-1 bg-pink-50 dark:bg-pink-900/30 text-pink-600 dark:text-pink-300 rounded-full text-xs font-medium hover:bg-pink-100 dark:hover:bg-pink-800/50 transition-colors border border-pink-100 dark:border-pink-800" data-prompt="這趟行程中，有什麼場合需要用到日文？請給我 5 句最實用的日文，包含租車、點餐。">
                🗣️ 實用日語
            </button>
            <button class="preset-btn whitespace-nowrap px-3 py-1 bg-sky-50 dark:bg-sky-900/30 text-sky-600 dark:text-sky-300 rounded-full text-xs font-medium hover:bg-sky-100 dark:hover:bg-sky-800/50 transition-colors border border-sky-100 dark:border-sky-800" data-prompt="根據你查詢到的天氣資訊，我這幾天該怎麼穿衣服？需要帶傘嗎？">
                ☁️ 穿搭建議
            </button>
            <button class="preset-btn whitespace-nowrap px-3 py-1 bg-amber-50 dark:bg-amber-900/30 text-amber-600 dark:text-amber-300 rounded-full text-xs font-medium hover:bg-amber-100 dark:hover:bg-amber-800/50 transition-colors border border-amber-100 dark:border-amber-800" data-prompt="我想買伴手禮，請根據我行程中的地點（福岡、熊本、由布院、阿蘇），推薦適合送給不同對象（例如長輩、同事、小孩）的具體名產或紀念品。請列出推薦清單。">
                🛍️ 挑選禮物
            </button>
            <button class="preset-btn whitespace-nowrap px-3 py-1 bg-teal-50 dark:bg-teal-900/30 text-teal-600 dark:text-teal-300 rounded-full text-xs font-medium hover:bg-teal-100 dark:hover:bg-teal-800/50 transition-colors border border-teal-100 dark:border-teal-800" data-prompt="如果行程因天氣或交通受阻，請根據我目前所在的區域（Day 2-6 在熊本/阿蘇/由布院，Day 1,7,8 在福岡），推薦 3 個室內備案或替代行程。">
                ☔️ 雨備改道
            </button>
            <button class="preset-btn whitespace-nowrap px-3 py-1 bg-red-50 dark:bg-red-900/30 text-red-600 dark:text-red-300 rounded-full text-xs font-medium hover:bg-red-100 dark:hover:bg-red-800/50 transition-colors border border-red-100 dark:border-red-800" data-prompt="我遇到緊急狀況（如身體不適、遺失物品）。請提供緊急求助的日文短句（例如：我不舒服、我有過敏、請幫叫救護車），並告訴我該怎麼做。">
                🆘 緊急求助
            </button>
            <button class="preset-btn whitespace-nowrap px-3 py-1 bg-gray-50 dark:bg-slate-700 text-gray-600 dark:text-slate-300 rounded-full text-xs font-medium hover:bg-gray-100 dark:hover:bg-slate-600 transition-colors border border-gray-100 dark:border-slate-600" data-prompt="我在餐廳看不懂菜單，或者想知道景點的歷史故事。請隨時準備好幫我翻譯或解說。現在請先教我幾句點餐和結帳的實用日文。">
                📸 翻譯/解說
            </button>
        </div>

        <!-- Input Area -->
        <div class="p-3 bg-white dark:bg-slate-800 border-t border-slate-100 dark:border-slate-700 shrink-0">
            <div class="flex items-center bg-slate-100 dark:bg-slate-700 rounded-full px-4 py-2 border border-transparent focus-within:border-indigo-300 focus-within:bg-white dark:focus-within:bg-slate-800 transition-all">
                <input type="text" id="chat-input" placeholder="問問關於行程的事..." class="bg-transparent border-none outline-none flex-1 text-sm text-slate-700 dark:text-slate-200 placeholder-slate-400 dark:placeholder-slate-500">
                <button id="send-btn" class="ml-2 text-indigo-500 hover:text-indigo-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
            <div class="text-[10px] text-center text-slate-400 mt-2">
                Powered by Google Gemini ✨
            </div>
        </div>
    </div>

    <script type="module">
        // --- Configuration ---
        // 📝 在下方引號內填入您的 Google Gemini API Key，即可免去手動設定的步驟
        // 例如: const envApiKey = "AIzaSy..."; 
        const envApiKey = ""; 

        const assistantBtn = document.getElementById('ai-assistant-btn');
        const chatModal = document.getElementById('ai-chat-modal');
        const closeChatBtn = document.getElementById('close-chat-btn');
        const settingsBtn = document.getElementById('settings-btn');
        const closeSettingsBtn = document.getElementById('close-settings-btn');
        const settingsPanel = document.getElementById('settings-panel');
        const apiKeyInput = document.getElementById('api-key-input');
        const saveKeyBtn = document.getElementById('save-key-btn');
        const chatMessages = document.getElementById('chat-messages');
        const chatInput = document.getElementById('chat-input');
        const sendBtn = document.getElementById('send-btn');
        const presetBtns = document.querySelectorAll('.preset-btn');
        const themeToggleBtn = document.getElementById('theme-toggle');
        const themeToggleDarkIcon = document.getElementById('theme-toggle-dark-icon');
        const themeToggleLightIcon = document.getElementById('theme-toggle-light-icon');
        
        let weatherContextData = "Weather data loading...";

        // --- Theme Toggle Logic ---
        function updateThemeIcon() {
            if (document.documentElement.classList.contains('dark')) {
                themeToggleDarkIcon.classList.add('hidden');
                themeToggleLightIcon.classList.remove('hidden');
            } else {
                themeToggleLightIcon.classList.add('hidden');
                themeToggleDarkIcon.classList.remove('hidden');
            }
        }

        // Initial icon state
        updateThemeIcon();

        themeToggleBtn.addEventListener('click', function() {
            // Toggle icons inside button
            themeToggleDarkIcon.classList.toggle('hidden');
            themeToggleLightIcon.classList.toggle('hidden');

            // If set via local storage previously
            if (localStorage.getItem('color-theme')) {
                if (localStorage.getItem('color-theme') === 'light') {
                    document.documentElement.classList.add('dark');
                    localStorage.setItem('color-theme', 'dark');
                } else {
                    document.documentElement.classList.remove('dark');
                    localStorage.setItem('color-theme', 'light');
                }
            } else {
                // If NOT set via local storage previously
                if (document.documentElement.classList.contains('dark')) {
                    document.documentElement.classList.remove('dark');
                    localStorage.setItem('color-theme', 'light');
                } else {
                    document.documentElement.classList.add('dark');
                    localStorage.setItem('color-theme', 'dark');
                }
            }
        });

        // --- API Key Management ---
        function getEffectiveApiKey() {
            const storedKey = localStorage.getItem('gemini_api_key');
            return storedKey || envApiKey;
        }

        // Initialize Input with stored key or env key
        const currentKey = getEffectiveApiKey();
        if (currentKey) {
            apiKeyInput.value = currentKey;
        }

        // Toggle Settings
        settingsBtn.addEventListener('click', () => {
            // Refresh input value to show the current effective key when opening
            const effectiveKey = getEffectiveApiKey();
            if (effectiveKey) {
                apiKeyInput.value = effectiveKey;
            }
            settingsPanel.classList.remove('hidden');
        });

        closeSettingsBtn.addEventListener('click', () => {
            settingsPanel.classList.add('hidden');
        });

        saveKeyBtn.addEventListener('click', () => {
            const newKey = apiKeyInput.value.trim();
            if (newKey) {
                localStorage.setItem('gemini_api_key', newKey);
                alert('API Key 已儲存！');
                settingsPanel.classList.add('hidden');
            } else {
                localStorage.removeItem('gemini_api_key');
                alert('API Key 已移除。');
                // Re-populate with env key if it exists, otherwise clear
                if (envApiKey) {
                    apiKeyInput.value = envApiKey;
                } else {
                    apiKeyInput.value = "";
                }
            }
        });


        // --- Weather Functionality ---
        const weatherConfig = [
            { day: 1, date: "2025-12-07", lat: 33.59, lon: 130.40, name: "福岡" },
            { day: 2, date: "2025-12-08", lat: 32.80, lon: 130.70, name: "熊本" },
            { day: 3, date: "2025-12-09", lat: 32.80, lon: 130.70, name: "熊本" },
            { day: 4, date: "2025-12-10", lat: 32.93, lon: 131.12, name: "阿蘇" },
            { day: 5, date: "2025-12-11", lat: 32.71, lon: 131.30, name: "高千穗" }, // Using Takachiho approx
            { day: 6, date: "2025-12-12", lat: 33.26, lon: 131.36, name: "由布院" },
            { day: 7, date: "2025-12-13", lat: 33.59, lon: 130.40, name: "福岡" },
            { day: 8, date: "2025-12-14", lat: 33.59, lon: 130.40, name: "福岡" }
        ];

        // WMO Weather interpretation codes (Simplified)
        function getWeatherIcon(code) {
            if (code === 0) return '<i class="fas fa-sun text-yellow-400"></i>';
            if (code === 1 || code === 2 || code === 3) return '<i class="fas fa-cloud-sun text-slate-400"></i>';
            if (code >= 45 && code <= 48) return '<i class="fas fa-smog text-slate-400"></i>';
            if (code >= 51 && code <= 67) return '<i class="fas fa-cloud-rain text-blue-400"></i>';
            if (code >= 71) return '<i class="fas fa-snowflake text-cyan-300"></i>';
            if (code >= 95) return '<i class="fas fa-bolt text-yellow-600"></i>';
            return '<i class="fas fa-cloud text-slate-400"></i>';
        }

        async function fetchWeather() {
            let contextBuilder = "Weather Forecast:\n";
            
            for (const item of weatherConfig) {
                const elementId = `weather-day-${item.day}`;
                const el = document.getElementById(elementId);
                
                try {
                    // Using Open-Meteo API
                    const url = `https://api.open-meteo.com/v1/forecast?latitude=${item.lat}&longitude=${item.lon}&daily=weather_code,temperature_2m_max,temperature_2m_min,precipitation_probability_max&timezone=Asia%2FTokyo&start_date=${item.date}&end_date=${item.date}`;
                    
                    const response = await fetch(url);
                    const data = await response.json();
                    
                    if (data.daily && data.daily.time.length > 0) {
                        const maxTemp = Math.round(data.daily.temperature_2m_max[0]);
                        const minTemp = Math.round(data.daily.temperature_2m_min[0]);
                        const precipProb = data.daily.precipitation_probability_max[0];
                        const code = data.daily.weather_code[0];
                        const iconHtml = getWeatherIcon(code);
                        
                        // Update UI
                        if (el) {
                            el.innerHTML = `
                                <div class="flex flex-col items-center weather-loaded">
                                    <div class="text-lg mb-0.5">${iconHtml}</div>
                                    <div class="font-bold text-slate-600 dark:text-slate-300 text-sm leading-none">${maxTemp}°</div>
                                    <div class="text-[10px] text-slate-400 leading-tight">${minTemp}°</div>
                                    <div class="text-[10px] text-blue-500 font-medium mt-0.5" title="降雨機率"><i class="fas fa-umbrella text-[8px] mr-0.5"></i>${precipProb}%</div>
                                </div>
                            `;
                        }
                        
                        // Add to Context
                        contextBuilder += `Day ${item.day} (${item.date}) in ${item.name}: Max ${maxTemp}°C, Min ${minTemp}°C, Rain ${precipProb}%, Weather Code ${code}.\n`;
                    } else {
                         if (el) el.innerText = "-";
                    }
                } catch (e) {
                    console.error("Weather fetch error", e);
                    if (el) el.innerHTML = '<i class="fas fa-exclamation-circle text-red-300"></i>';
                }
            }
            weatherContextData = contextBuilder;
        }

        // Call Weather Fetch on Init
        fetchWeather();

        // --- Context Extraction ---
        // Get the itinerary text from the DOM to give context to the AI
        function getItineraryContext() {
            const itineraryContainer = document.getElementById('itinerary-content');
            if (!itineraryContainer) return "No itinerary found.";
            return itineraryContainer.innerText.replace(/\s+/g, ' ').trim();
        }
        
        // --- State ---
        let isChatOpen = false;
        let isGenerating = false;

        // --- UI Functions ---
        function toggleChat() {
            isChatOpen = !isChatOpen;
            if (isChatOpen) {
                chatModal.classList.remove('hidden');
                chatModal.classList.remove('chat-slide-out');
                chatModal.classList.add('chat-slide-in');
                // Focus input
                setTimeout(() => {
                    chatInput.focus();
                    scrollToBottom();
                }, 300);
            } else {
                chatModal.classList.remove('chat-slide-in');
                chatModal.classList.add('chat-slide-out');
                setTimeout(() => chatModal.classList.add('hidden'), 300);
            }
        }

        function scrollToBottom() {
            if (chatMessages) {
                // Force scroll to bottom instantly without smooth behavior to ensure visibility
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
        }

        function appendUserMessage(text) {
            const msgDiv = document.createElement('div');
            msgDiv.className = 'flex items-start justify-end';
            msgDiv.innerHTML = `
                <div class="bg-indigo-600 text-white p-3 rounded-2xl rounded-tr-none shadow-sm text-sm max-w-[85%] break-words">
                    ${text}
                </div>
            `;
            chatMessages.appendChild(msgDiv);
            scrollToBottom();
        }

        function appendAIMessage(htmlContent) {
            const msgDiv = document.createElement('div');
            msgDiv.className = 'flex items-start';
            msgDiv.innerHTML = `
                <div class="w-8 h-8 rounded-full bg-indigo-100 dark:bg-indigo-900/50 flex items-center justify-center mr-2 shrink-0 border border-indigo-200 dark:border-indigo-700">
                    <i class="fas fa-robot text-indigo-500 dark:text-indigo-300 text-xs"></i>
                </div>
                <div class="bg-white dark:bg-slate-800 p-3 rounded-2xl rounded-tl-none shadow-sm text-sm border border-slate-100 dark:border-slate-700 max-w-[85%] prose prose-sm prose-indigo dark:prose-invert break-words text-slate-700 dark:text-slate-200">
                    ${htmlContent}
                </div>
            `;
            chatMessages.appendChild(msgDiv);
            scrollToBottom();
        }

        function appendLoadingIndicator() {
            const id = 'loading-' + Date.now();
            const msgDiv = document.createElement('div');
            msgDiv.id = id;
            msgDiv.className = 'flex items-start';
            msgDiv.innerHTML = `
                <div class="w-8 h-8 rounded-full bg-indigo-100 dark:bg-indigo-900/50 flex items-center justify-center mr-2 shrink-0 border border-indigo-200 dark:border-indigo-700">
                    <i class="fas fa-robot text-indigo-500 dark:text-indigo-300 text-xs"></i>
                </div>
                <div class="bg-white dark:bg-slate-800 p-4 rounded-2xl rounded-tl-none shadow-sm border border-slate-100 dark:border-slate-700">
                    <div class="flex space-x-1">
                        <div class="w-2 h-2 bg-slate-400 rounded-full typing-dot"></div>
                        <div class="w-2 h-2 bg-slate-400 rounded-full typing-dot"></div>
                        <div class="w-2 h-2 bg-slate-400 rounded-full typing-dot"></div>
                    </div>
                </div>
            `;
            chatMessages.appendChild(msgDiv);
            scrollToBottom();
            return id;
        }

        function removeLoadingIndicator(id) {
            const el = document.getElementById(id);
            if (el) el.remove();
        }

        // --- Gemini API Logic ---
        async function callGemini(userPrompt) {
            if (isGenerating) return;
            const activeKey = getEffectiveApiKey();

            if (!activeKey) {
                appendAIMessage("⚠️ 請先設定 API 金鑰！<br>請點擊右上角的齒輪圖示 ⚙️，輸入您的 Google Gemini API Key。");
                settingsPanel.classList.remove('hidden'); // Auto open settings
                return;
            }

            isGenerating = true;
            sendBtn.disabled = true;
            chatInput.disabled = true;

            const loadingId = appendLoadingIndicator();

            try {
                const itineraryContext = getItineraryContext();
                // Combine Itinerary AND Weather for the AI
                const fullContext = itineraryContext + "\n\n" + weatherContextData;

                // System Prompt
                const systemInstruction = `
                    你是一位專業的日本福岡旅遊導遊助手。
                    使用者的旅遊行程與天氣預報如下：
                    ---
                    ${fullContext}
                    ---
                    請根據上述行程回答使用者的問題。
                    1. 如果使用者問行程相關問題，請精準參考行程內容。
                    2. 如果使用者問天氣或穿搭，請務必參考提供的 "Weather Forecast" 數據來回答。
                    3. 回答請使用繁體中文 (Traditional Chinese)。
                    4. 語氣請熱情、友善、專業。
                    5. 如果需要，可以使用 Emoji 增加活潑感。
                    6. 使用 Markdown 格式排版重點。
                `;

                // API Payload
                const payload = {
                    contents: [{
                        parts: [{ text: userPrompt }]
                    }],
                    systemInstruction: {
                        parts: [{ text: systemInstruction }]
                    }
                };

                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${activeKey}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`API Error: ${response.status}`);
                }

                const data = await response.json();
                const aiText = data.candidates?.[0]?.content?.parts?.[0]?.text;

                removeLoadingIndicator(loadingId);

                if (aiText) {
                    // Convert Markdown to HTML using marked.js
                    const htmlContent = marked.parse(aiText);
                    appendAIMessage(htmlContent);
                } else {
                    appendAIMessage("抱歉，我現在有點暈，請稍後再問我一次 😵‍💫");
                }

            } catch (error) {
                console.error("Gemini Error:", error);
                removeLoadingIndicator(loadingId);
                appendAIMessage("發生連線錯誤或金鑰無效，請檢查網路或重新設定金鑰。");
            } finally {
                isGenerating = false;
                sendBtn.disabled = false;
                chatInput.disabled = false;
                chatInput.focus();
            }
        }

        // --- Event Listeners ---
        assistantBtn.addEventListener('click', toggleChat);
        closeChatBtn.addEventListener('click', toggleChat);

        // Send Message
        const handleSend = () => {
            const text = chatInput.value.trim();
            if (!text) return;
            appendUserMessage(text);
            chatInput.value = '';
            callGemini(text);
        };

        sendBtn.addEventListener('click', handleSend);
        chatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') handleSend();
        });

        // Preset Chips
        presetBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                const prompt = btn.getAttribute('data-prompt');
                appendUserMessage(btn.innerText.split(' ')[1]); // Show short text in bubble
                callGemini(prompt); // Send full prompt to AI
            });
        });

    </script>
</body>

</html>
